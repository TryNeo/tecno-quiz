{% extends 'base.html' %}
{% block content %}
<div class="px-4 py-5">
    <h1 class="display-5 fw-bold text-center mb-4">{{name_slug}}</h1>
    <div class="col-lg-8 mx-auto">
        <p class="lead mb-4 text-center">
            Bienvenido üòÄ , Aqu√≠ podr√°s encontrar una gran variedad de preguntas 
            a resolver , el Quiz consta con 20 preguntas aleatorias para que puedas resolverlo sin l√≠mite de tiempo.
            <br>
            <span style="font-weight: 400;">Si deseas agregar una nueva pregunta , <a href="#">cont√°ctanos</a> para que te podamos ayudar </span>
        </p>
      <div class="d-grid gap-2 d-sm-flex justify-content-sm-center text-center">
        <button type="button" onclick="return showQuiz('a');" class="btn btn-outline-secondary btn-lg px-4">Realizar Quiz</button>
      </div>
    </div>
  </div>
    {% comment %}
    <div id="quiz"></div>
    <button id="submit">Submit Quiz</button>
    <div id="results"></div>
    {% endcomment %}
{% endblock %}
{% comment %}

{% block extra_js %}
<script type="text/javascript">
    const quizContainer = document.getElementById('quiz');
    const resultsContainer = document.getElementById('results');
    const submitButton = document.getElementById('submit');
    const Questions = {{data|safe}};


    function buildQuiz(){
        const output = [];
        Questions.forEach(
        (currentQuestion, questionNumber) => {
            const answers = [];
            for(letter in currentQuestion.answers){
                answers.push(
                    `<label>
                    <input type="radio" name="question${questionNumber}" value="${currentQuestion.answers[letter]['name']}">
                    ${currentQuestion.answers[letter]['name']}
                    </label>`
                );
            }
            output.push(
            `<div class="question"> ${currentQuestion.question_name} </div>
            <div class="answers"> ${answers.join('')} </div>`
            );
            }
        );
        quizContainer.innerHTML = output.join('');
    }


    function showResults(){
        const answerContainers = quizContainer.querySelectorAll('.answers');
        let numCorrect = 0;
        Questions.forEach( (currentQuestion, questionNumber) => {
            const answerContainer = answerContainers[questionNumber];
            const selector = `input[name=question${questionNumber}]:checked`;
            const userAnswer = (answerContainer.querySelector(selector) || {}).value;
            console.log(userAnswer)
            if(userAnswer === currentQuestion.correct){
                numCorrect++;
                answerContainers[questionNumber].style.color = 'lightgreen';
            }
            else{
                answerContainers[questionNumber].style.color = 'red';
            }
        });

        // show number of correct answers out of total
        resultsContainer.innerHTML = `${numCorrect} out of ${Questions.length}`;
        }


    buildQuiz();
    submitButton.addEventListener('click', showResults)
</script>
{% endblock%}
{% endcomment %}
